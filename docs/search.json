[
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "Juan Riera",
    "section": "",
    "text": "Actualmente estoy retirado por jubilación, y me he propuesto el objetivo de transmitir lo que me sea posible de mi experiencia profesional y conocimientos que he podido adquirir en el ejercicio de la profesión. Con este motivo, colaboro con proyectos de formación tecnológica en la Formación Profesional y en la Universidad, y he puesto en marcha este blog para escribir notas tecnológicas referentes sobre todo a la estadística industrial y el uso de algunas herramientas básicas como Excel y R. Esto me permite seguir estudiando y aprendiendo, mientras practico."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Blog de Juan Riera",
    "section": "",
    "text": "Jan 28, 2023\n\n\nJuan Riera\n\n\n\n\n\n\n  \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nJan 21, 2023\n\n\nJuan Riera\n\n\n\n\n\n\n  \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nJan 14, 2023\n\n\nJuan Riera\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts/excel-xy/index.html",
    "href": "posts/excel-xy/index.html",
    "title": "Cómo hacer gráficos XY en Microsoft Excel a partir de datos arreglados (tidy)",
    "section": "",
    "text": "En el mundo de la empresa, la utilización de las hojas de cálculo, sobre todo de Microsoft Excel, está mucho más extendida que la de lenguajes como R o python. Por esta razón, siempre que enseño métodos de análisis de datos en R, intento presentar también, si es posible, cómo se realizarían los mismos análisis en Excel, y viceversa, comparando ventajas e inconvenientes de ambas herramientas. Así, aquellas personas que no están formadas en R, pero sí tienen experiencia en Excel, pueden optar por el aprendizaje de R, o simplemente realizar el método presentado con la hoja de cálculo.\nUna de las cosas que siempre he echado de menos en Excel, y que es muy fácil en R o python, es la posibilidad de hacer gráficos XY segmentados por una columna adicional que se utiliza para codificar en color de acuerdo con los valores de esa columna. Con ggplot en R, es inmediato utilizar colour para las categorías:\nSi queremos evitar el solapamiento de puntos en los valores repetidos, podemos usar la geometría geom_jitter():\nEl inconveniente de este gráfico en Excel es que para asignar diferentes colores a las series, Excel necesita que las series estén separadas en diferentes columnas. Esto es debido probablemente a que el diseño de Excel es muy anterior a los conceptos modernos de datos arreglados (tidy data) y a los modernos programas de análisis de datos como R, python, o incluso el propio Power BI de Microsoft.\nHe encontrado algunas soluciones creativas a este problema, entre ellas la de Vidya en su blog Daydreaming Numbers. La solución que ella propone es la creación de las columnas necesarias con los campos de clasificación, y mediante fórmulas condicionales, recolocar los valores en estas nuevas columnas. Sin embargo, aunque la solución funciona, no cumple con mi requerimiento de respetar el formato de datos arreglados (tidy), y no es compatible con el uso avanzado de tablas en Excel y en Power Pilot / Power BI.\nLa solución que yo estoy buscando debe llegar a través de métodos que no alteren la estructura de los datos originales, y sean compatibles con las nuevas herramientas como Power Pivot, Power BI, o lenguajes como R o python. Esto exige no modificar la tabla de datos original, o en todo caso, hacerlo respetando los datos y la estructura originales.\nEl método que he elegido es utilizar las tablas dinámicas. Desgraciadamente (e inexplicablemente), las tablas dinámicas no permiten la utilización de gráficos dinámicos XY, por lo que los usuarios han buscado formas alternativas de crearlos. La que vamos a utilizar aquí es la creación de un gráfico XY a partir de la asignación manual de los rangos de datos de la tabla dinámica.\nUtilizaremos el dataset iris(Conjunto de datos Iris en Wikipedia, Conjunto de datos Iris en kaggle), exportado desde R, que convertimos en una tabla de Excel mediante Menu>Insertar>Tabla\nQueremos hacer una gráfica XY de la columna Sepal.Length frente a Petal.Width. Comenzamos insertando una tabla dinámica a partir de esta tabla, y colocamosSpeciesen columnas,Sepal.Lengthen filas yPetal.Widthen valores.\nVamos a introducir algunas opciones de diseño de la tabla dinámica que nos facilitan el trabajo de construcción del gráfico. Haciendo click derecho en cualquier parte de la tabla, seleccionamos Opciones de la tabla dinámica. En la pestaña Diseño y formato, deseleccionamos la opción Autoajustar anchos de columnas al actualizar(de forma que quitemos la marca de check). En la pestaña Totales y filtros, deseleccionamos las dos opciones de Totales generales, de manera que quitemos la marca de Mostrar totales generales de filasy de Mostrar totales generales de las columnas.\nExcel siempre utiliza fórmulas de agrupación en los campos de valores, y por defecto utiliza Recuento. La fórmula de Recuento nos permite ver que hay algunas parejas de valores que están repetidas, por ejemplo, hay 8 valores de Petal.Widthque coinciden con un valor de 5 en Sepal.Length y que la tabla dinámica ha agrupado. Esto es un inconveniente porque en un gráfico XY queremos que nos aparezcan todos los pares de valores sin agrupar, para que la nube de puntos represente el total de los datos.\nPor el momento vamos a explorar hasta dónde nos permite llegar la tabla dinámica con sus opciones de formato ordinarias. Para representar valores de Petal.Width, reemplazamos la fórmula de Recuentopor la de Promedio. Para ello hacemos click-derecho sobre uno de los campos de valor en la tabla, y seleccionamos Resumir valores... y a continuación, Promedio.\nEsta tabla ya nos permite representar pares de valores. Como hemos visto, si intentamos insertar un gráfico dinámico XY, Excel nos devuelve un mensaje advirtiendo que no es posible presentar este gráfico.\nEl único gráfico de puntos que podríamos insertar como gráfico dinámico es un gráfico de líneas y puntos al que podemos borrar las líneas de forma que sólo queden los puntos, Pero este gráfico no es el que buscamos, porque presenta los valores X siguiendo la secuencia que tienen los números en la fila de la tabla dinámica,, y no respeta que la distancia entre los valores (los intervalos) se corresponda con la magnitud del valor numérico.\nSi observamos el gráfico, vemos que los valores al principio del eje X se separan 0,2 unidades, mientras que los últimos valores se separan 0,3 unidades. Esto hace que la escala horizontal no se respete correctamente; el gráfico no es válido.\nPara conseguir un gráfico XY verdadero, en el que ambos ejes respeten la posición de los valores según su magnitud, empezamos insertando un gráfico XY en blanco a la derecha de la tabla dinámica. Para ello, colocamos el cursor dos columnas a la derecha de la tabla dinámica e insertamos un nuevo gráfico XY, que nos aparecerá como un marco en blanco, ya que no hemos establecido ningún rango de datos. Esto es lo que haremos a continuación.\nHaciendo click derecho sobre el marco vacío del gráfico, seleccionamos la opción Seleccionar datos.... Ahora vamos a ir agregando nuestras seres manualmente. Hacemos click en Agregar\nExcel nos abre la ventana de selección de los datos de las series.\nVerificamos que los valores X y los valores Y de la serie tengan la misma longitud de rango (en este caso, desde la fila 1 hasta la 39). Una vez rellenada la serie, seleccionamos Aceptar\nRepetimos el proceso para las otras dos series, seleccionando el nombre de variable, el rango X (hay que reintroducirlo cada vez en cada serie), y el rango Y. Si todo ha ido bien, deberíamos tener nuestra primera versión del gráfico\nAjustamos la escala del eje X para un mínimo de 4, añadimos rótulos de ejes y leyenda\nEste es un gráfico XY verdadero, en el que la escala de los ejes X e Y respeta la distancia que indica la magnitud del valor numérico, y por lo tanto, sitúa los puntos en una posición correcta. Este gráfico XY, en el que los valores Y están resumidos en un valor único, puede ser útil en algunas circunstancias; nos simplifica la representación gracias a que la fórmula Promedionos reduce a un punto todos los valores de Y que se corresponden con un valor determinado de X. Nos permite visualizar claramente las diferencias entre las tres poblaciones que estamos representando; sin embargo, no es el gráfico que buscamos, porque no hemos representado cada par de valores que existe en la tabla de datos original, estén repetidos o no.\nPara construir el gráfico correcto tenemos que “engañar” a Excel de nuevo, haciendo que cada valor de X y cada valor de Y sea diferente. Así Excel no podrá agruparlos, y la fórmula de resumen Promedio nos devolverá en realidad el promedio de un solo valor en cada celda de la tabla dinámica. Tener un valor único no es un problema para Excel, porque simplemente utiliza 1 como divisor del promedio.\nPara conseguir nuestro objetivo, tenemos que volver a la tabla original y crear dos nuevas columnas, que se corresponderán con los ejes X e Y. Calcularemos los nuevos valores mediante una fórmula que sume un valor aleatorio suficientemente largo al valor original como para que la probabilidad de que coincidan dos valores sea casi cero. Para evitar modificar el valor original, dividimos el valor aleatorio por un exponente de 10 tal que la serie de decimales que obtenemos esté siempre por detrás del último valor decimal de la serie original. Por ejemplo, si nuestros valores tienen un decimal, dividimos el valor aleatorio entre 100. Las fórmulas que utilizo son =[@[Sepal.Length]]+ALEATORIO()/100y =[@[Petal.Width]]+ALEATORIO()/100. Este método tiene un efecto semejante a la utilización de jitteren ggplot.\nEsta es la tabla modificada:\nVemos que los valores de las dos columnas añadidas son idénticos en las dos primeras cifras significativas al valor de la columna original (el valor original entero más un decimal); el segundo decimal es un cero, y a continuación viene la secuencia de números aleatorios. Dado que esta secuencia comienza en el tercer decimal, el efecto sobre la posición de cada valor en el gráfico será prácticamente indetectable y no la falseará.\nInsertamos una nueva tabla dinámica a partir de esta tabla, utilizando en filas y en valores las nuevas variables calculadas; verificamos mediante la fórmula Recuento que ahora ya no hay valores acumulados, cada pareja de valores es única.\nSustituimos la fórmula Recuentopor la fórmula Promedioy repetimos todo el proceso que hemos hecho anteriormente:\nEste es mi gráfico XY final en Excel:\nY este es el gráfico en ggplot, ligeramente modificado respecto al que vimos al principio del artículo\nEl gráfico XY en Excel es mucho más largo de hacer que en ggplot, pero es perfectamente realizable, como hemos visto. Tiene la ventaja de la gran facilidad de edición de la hoja de cálculo, que permite un grado de personalización casi ilimitado.\nComo inconveniente, en Excel el uso de estas opciones de personalización no se presentan en el gráfico de ninguna manera, y por lo tanto no siempre son fáciles de reproducir por otras personas. Es necesario acceder a la hoja original y bucear entre las opciones, algunas de las cuales puede que no sean fáciles de encontrar. En la versión final del gráfico en Excel no hay nada que indique cómo se ha dado el formato de los títulos, las series, los colores, etc. En cambio, en el fragmento de código R, podemos leer con claridad cada opción de formato y de personalización utilizada, y por lo tanto podemos repetir exactamente el gráfico, o utilizar el formato en otro gráfico.\nEsa es una de la grandes ventajas del código R: la reproducibilidad de los informes, y una de las razones para promover su utilización no sólo en el mundo de la investigación y la Universidad, sino en la empresa en general."
  },
  {
    "objectID": "posts/excel-xy/index.html#para-probar",
    "href": "posts/excel-xy/index.html#para-probar",
    "title": "Cómo hacer gráficos XY en Microsoft Excel a partir de datos arreglados (tidy)",
    "section": "Para probar",
    "text": "Para probar\nAl construir las columnas de valores modificados, vimos que el efecto del cálculo sobre la posición de cada valor es prácticamente inapreciable, debido a que la secuencia aleatoria empieza sólo en el tercer decimal. Modificando el factor de multiplicación y división en las fórmulas de las columnas calculadas, podemos aumentar el efecto de jitter en caso de que el solapamiento sea excesivo. Si recalculamos manualmente la tabla dinámica podremos ver el efecto producido por la modificación de los decimales y decidir si el efecto es bajo, excesivo, o es el que queremos."
  },
  {
    "objectID": "posts/tabla-frec/index.html",
    "href": "posts/tabla-frec/index.html",
    "title": "Cómo hacer una tabla de frecuencias en R con tidyverse",
    "section": "",
    "text": "Para hacer una tabla de frecuencias, el primer paso es cargar la librería tidyverse y leer los datos en \\(R\\), en este caso a partir de un archivo CSV.\nComo el .CSV ha sido generado desde Excel en español, los separadores son puntos y comas, y el separador de los decimales será la coma, y tendrá este aspecto èn un editor de texto básico:\nPara leer este archivo, utilizaremos la función read_csv2()que se adapta a este formato usado en Europa (utiizamos la función de tidyversey no la función read.csv2()de \\(R\\) básico)\nVamos a utilizar los pipes de \\(R\\) para construir nuestra tabla paso a paso. El primer paso es seleccionar la variable de la que vamos a hacer la tabla, en este caso es \\(est\\), el \\(extracto\\ seco\\ total\\).\nA continuación, agrupamos los valores por intervalos. Para ello usamos la función cut_width() de la librería ggplot2, que nos permite cortar los valores en intervalos, definidos por el parámetro width=; en este caso, damos al intervalo una amplitud de \\(1\\).\nLo que hemos hecho es designar el intervalo al que pertenecen todos los valores de \\(est\\), con la amplitud de intervalo que hemos definido mediante el parámetro elegido.\nEl paso siguiente es agrupar los intervalos, contando el número de veces que aparece cada uno.\nParece que no ha sucedido nada porque en tidyversenecesitamos indicar cómo vamos a utilizar la agrupación. En este caso, queremos contar el nímero de veces que aparece cada intervalo, lo que nos dará la frecuencia de valores que aparecen en ese intervalo. Para ello, usamos summarize(). Esta función sustituye el dataframe original por un nuevo dataframe con el resultado de la agrupación de est_group, creando además una nueva variable, que llamaremos \\(frec\\) y que cuenta el número de veces que aparece cada valor de intervalo mediante la función n()\nYa tenemos nuestra tabla de frecuencias. Sin embargo, tenemos un inconveniente, y es que la agrupación se salta aquellos intervalos que tienen frecuencia \\(cero\\): no nos apararece el intervalo \\((50.5,51.5]\\) ni el \\((51.5,52.5]\\) porque no hay ningún valor en estos intervalos. Por defecto, al igual que pasa en Excel, los casos inexistentes (con una frecuencia de \\(cero\\)) no aparecen en la tabla de frecuencias. Pero, al contrario que en Excel, en \\(R\\) sí tenemos una forma de decir que queremos que aparezcan, y es rellenar los casos \\(cero\\) con el valor \\(0\\). Utilizamos para ello la función complete()\nAhora sí está completa nuestra tabla de frecuencias.\nResumiendo los pasos que hemos dado,\nSi queremos utilizar la tabla de frecuencias, podemos guardarla en una variable.\nVerificamos nuestra tabla, imprimiendo la variable que hemos creado:\nCon esta tabla de frecuencia podemos hacer un gráfico de barras\nque es equivalente a un histograma con la parametrización adecuada"
  },
  {
    "objectID": "posts/tabla-frec/index.html#otras-alternativas",
    "href": "posts/tabla-frec/index.html#otras-alternativas",
    "title": "Cómo hacer una tabla de frecuencias en R con tidyverse",
    "section": "Otras alternativas",
    "text": "Otras alternativas\nLa elección de la función de corte nos permite agrupar los intervalos de forma ligeramente diferente. Si utiizamos como opción cut_interval= en vez de cut_width=, y utilizamos el parámetro n=, definiremos el número de intervalos y no la amplitud. Veamos el efecto en el diagrama de utilizar esta opción con n = 9:\n\ndf |>\n  select(est) |>\n  mutate(est_group = cut_interval(est, n = 9)) |>\n  group_by(est_group) |>\n  summarize (frec = n()) |>\n  complete(est_group, fill = list(frec = 0)) |>\n  ggplot(aes(x=est_group, y = frec)) +\n    geom_col()\n\n\n\n\nEl parámetro opcional cut_interval= también permite definir la amplitud del intervalo (no siempre es compatible con el parámetro n= ya que el intervalo que proporcionemos en length= puede no corresponderse con el número de clases que definimos con n=)\n\ndf |>\n  select(est) |>\n  mutate(est_group = cut_interval(est, length = 1)) |>\n  group_by(est_group) |>\n  summarize (frec = n()) |>\n  complete(est_group, fill = list(frec = 0)) |>\n  ggplot(aes(x=est_group, y = frec)) +\n    geom_col()\n\n\n\n\n\nPara probar\nA partir del último bloque de código, encuentra la forma de obtener e imprimir la tabla de frecuencias que se obtiene con cut_interval="
  },
  {
    "objectID": "posts/tabla-frec-excel/index.html",
    "href": "posts/tabla-frec-excel/index.html",
    "title": "Cómo hacer una tabla de frecuencias en Excel",
    "section": "",
    "text": "Hay varias formas de preparar una tabla de frecuencia en Excel. Aquí usaremos dos métodos:"
  },
  {
    "objectID": "posts/tabla-frec-excel/index.html#construir-una-tabla-de-frecuencias-usando-la-función-frecuencia-de-excel.",
    "href": "posts/tabla-frec-excel/index.html#construir-una-tabla-de-frecuencias-usando-la-función-frecuencia-de-excel.",
    "title": "Cómo hacer una tabla de frecuencias en Excel",
    "section": "Construir una tabla de frecuencias usando la función FRECUENCIA() de Excel.",
    "text": "Construir una tabla de frecuencias usando la función FRECUENCIA() de Excel.\nSuponemos que nuestros datos están en una tabla de Excel.\n\nVamos a hacer una tabla de frecuencias de los datos de \\(extracto\\ seco\\ total\\), que están guardados en la tabla en la variable(columna) \\(est\\).\nRecordemos que la tabla de datos es intocable, no vamos a introducir ningún cálculo en esta tabla. Lo que haremos será crear una nueva hoja a continuación.\nEn esta hoja introduciremos las clases de frecuencia que deseamos utilizar, empezando por un valor redondeado por debajo del mínimo de los valores. Podemos introducir este valor mediante fórmula o simplemente a mano.\n\nLa fórmula nos asegura no equivocarnos en el valor, pero es menos complicado comprobar este valor mínimo en la flechita del filtro de la tabla\n\nEn la primera fila, celda A1, colocamos el rótulo de la serie, que en nuestro caso vamos a llamar \\(est\\_clases\\)\nPor cualquiera de los dos métodos (fórmula o directo), establecemos el valor inicial de nuestra serie de clases, en este caso, 42.\nA partir de este valor, utilizando el intervalo que deseemos, rellenamos hacia abajo hasta un valor por encima del máximo.\n\nDe nuevo, rotulamos la celda superior (B1en este caso) con la descripción de lo que vamos a obtener, Frecuencia\nLa fórmula FRECUENCIA()necesita dos rangos: el de entrada, con los valores originales, y el de las clases, que hemos creado. Los valores originales están en la columna estde nuestra tabla original, y el rango de clases, en la nueva hoja.\n\nAl ejecutar la fórmula mediante <INTRO>, Excel rellena la columna a la derecha de nuestro rango de clases con la frecuencia correspondiente a cada clase.\n\nHay que tener en cuenta que, aunque Excel no nos define en la tabla el tipo de intervalo que hemos obtenido. la fórmula de cálculo es tal que la frecuencia indicada corresponde a un <= que el valor de clase. Es decir, Excel calcula los intervalos considerando el valor que damos en la clase como el límite superior del intervalo, incluído el propio valor. Para evitar confusiones, es útil añadir una columna con los intervalos especificados de forma manual.\n\nA partir de la tabla de frecuencia, puede hacerse un diagrama de barras"
  },
  {
    "objectID": "posts/tabla-frec-excel/index.html#construir-una-tabla-de-frecuencias-utilizando-las-tablas-dinámicas",
    "href": "posts/tabla-frec-excel/index.html#construir-una-tabla-de-frecuencias-utilizando-las-tablas-dinámicas",
    "title": "Cómo hacer una tabla de frecuencias en Excel",
    "section": "Construir una tabla de frecuencias utilizando las tablas dinámicas",
    "text": "Construir una tabla de frecuencias utilizando las tablas dinámicas\nLo primero que haremos será insertar una tabla dinámica, y la crearemos en una hoja nueva.\nPara ello, colocamos el cursor en una celda cualquiera dentro de la tabla de datos y buscamos la opción en el menú Insertar>Tabla dinámica. Aceptamos las opciones de Tabla o rango y de Nueva hoja de cálculo:\n\nUna vez creada la nueva tabla dinámica, en la definición de campos de tabla dinámica colocamos en Filas y en Valoresla variable de la cual queremos hacer la tabla de frecuencias, en nuestro caso, \\(est\\).\n\nAhora modificamos la definición de Valores, sustituyendo Suma por Recuento. Para ello, pulsamos en la flecha de opciones a la derecha y elegimos la opción Configuración de campo de valor:\n\nSeleccionamos Recuento y aceptamos\n\nNuestra tabla debe tener este aspecto:\n\nAhora hacemos click derecho en el ratón sobre uno cualquiera de los valores de \\(est\\) en la columna A y elegimos Agrupar...Aquí podemos mantener la opción por defecto presentada o elegir nuestra configuración. En este caso, yo he elegido agrupar desde 42 hasta 56 de 2 en 2\n\nLa tabla dinámica nos agrupa los resultados, presentando la tabla de frecuencia\n\nDe nuevo, podemos insertar un diagrama de barras desde el menú Insertar, escogiendo el gráfico de barras. Esto inserta un gráfico dinámico que se modificará automáticamente si cambiamos el diseño de nuestra tabla.\n\nEl uso de las tablas dinámicas tiene dos ventajas principales:\n\nLa rapidez con la que se puede cambiar la configuración del agrupamiento, y\nla posibilidad de crear gráficos dinámicos enlazados, como hemos visto\n\nUna cuestión muy importante a tener en cuenta es que el contenido de una tabla dinámica no se puede editar manualmente, todas las modificaciones deben hacerse manejando la interface de las tablas dinámicas.\nOtra consideración es que la tabla dinámica ignorará las clases vacías (con valor de frecuencia \\(cero\\)). Es necesario prestar atención a que, si fuese el caso, esta característica no nos introduzca efectos no deseados en la gráfica, falseando los resultados. Por esta razón, casi siempre es más seguro hacer nuestras tablas de frecuencia utilizando el primer método, la fórmula FRECUENCIA(), y ajustando los ceros si es necesario.\nA veces es posible que la agrupación de la tabla dinámica presente un mensaje de que los datos no pueden ser agrupados. Esto sucede cuando hay un error en los datos (por ejemplo, si hay datos de texto entre los valores numéricos que no hemos detectado) o si hay valores en blanco en la tabla original. El uso de los filtros sobre la tabla original permite encontrar este tipo de errores con cierta facilidad"
  },
  {
    "objectID": "posts/tabla-frec-excel/index.html#para-probar",
    "href": "posts/tabla-frec-excel/index.html#para-probar",
    "title": "Cómo hacer una tabla de frecuencias en Excel",
    "section": "Para probar",
    "text": "Para probar\nIntenta rehacer la tabla anterior reagrupando las clases de la tabla dinámica por intervalos de \\(1\\). Haz lo mismo mediante la función FRECUENCIA()"
  }
]